<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>身份證號碼生成與校驗器 | 現代版</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        /* ================================================= */
        /* == 1. 核心變數 (配色與動效) */
        /* ================================================= */
        :root {
            /* 主色調 (藍色) */
            --color-primary: #007bff;
            --color-primary-hover: #0056b3;
            /* 輔助色調 (綠色，用於成功/校驗) */
            --color-success: #28a745;
            --color-success-light: #d4edda;
            /* 背景與文字 (日模式) */
            --color-bg: #F0F2F5; /* 柔和淺灰 */
            --color-text: #333333;
            --color-card-bg: rgba(255, 255, 255, 0.9); /* 玻璃卡片背景 */
            --color-border: #e0e0e0;
            --color-input-bg: #ffffff;
            /* 動畫過渡 */
            --transition-speed: 0.3s;
        }

        /* ================================================= */
        /* == 2. 夜間模式變數 (Dark Mode) */
        /* ================================================= */
        .dark-mode {
            --color-bg: #121212; /* 深灰/黑底，不刺眼 */
            --color-text: #E0E0E0;
            --color-card-bg: rgba(30, 30, 30, 0.7); /* 深色玻璃卡片 */
            --color-border: #444444;
            --color-input-bg: #282828;
            --color-success: #4CAF50; /* 綠色保持，但略為調整亮度 */
            --color-success-light: #1e3a23; /* 深色模式下的成功背景 */
        }
        
        /* ================================================= */
        /* == 3. 基礎樣式與版面 */
        /* ================================================= */
        body {
            font-family: 'Noto Sans TC', Arial, sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            padding: 30px 20px;
            max-width: 800px;
            margin: auto;
            line-height: 1.6;
            transition: background-color var(--transition-speed), color var(--transition-speed);
        }

        h2 {
            border-bottom: 2px solid var(--color-border);
            padding-bottom: 10px;
            margin-top: 40px;
            font-weight: 700;
            color: var(--color-primary); /* 標題使用品牌色 */
        }
        
        .card-container {
            background: var(--color-card-bg);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 40px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            /* Glassmorphism 核心效果 */
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3); /* 輕微邊框增加質感 */
            transition: background var(--transition-speed), border var(--transition-speed);
        }

        /* ================================================= */
        /* == 4. 表單元素與互動美化 */
        /* ================================================= */
        .input-group { margin-bottom: 20px; }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 400;
            font-size: 15px;
            opacity: 0.85;
        }

        select, input[type="text"], input[type="date"] {
            width: 100%;
            padding: 12px 15px;
            box-sizing: border-box;
            font-size: 16px;
            border: 1px solid var(--color-border);
            border-radius: 8px; /* 更圓潤的邊角 */
            background-color: var(--color-input-bg);
            color: var(--color-text);
            transition: border-color var(--transition-speed), box-shadow var(--transition-speed), background-color var(--transition-speed);
            -webkit-appearance: none; /* 移除默認樣式 */
            appearance: none;
        }
        
        select {
             /* 給下拉選單增加一個自訂箭頭，使其在各瀏覽器更統一 */
            background-image: url('data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2224%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cpath%20d%3D%22M7%2010l5%205%205-5z%22%20fill%3D%22%23666666%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 10px center;
            padding-right: 30px;
        }

        select:focus, input[type="text"]:focus, input[type="date"]:focus {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25); /* 聚焦時的藍色光暈 */
            outline: none;
        }

        /* ================================================= */
        /* == 5. 按鈕美化與動效 */
        /* ================================================= */
        button {
            width: 100%;
            padding: 15px 20px;
            margin: 15px 0;
            border: none;
            cursor: pointer;
            font-size: 17px;
            font-weight: 700;
            border-radius: 8px;
            transition: background-color var(--transition-speed), transform var(--transition-speed), box-shadow var(--transition-speed);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        /* 生成按鈕 (藍色主色) */
        #generateButton {
            background-color: var(--color-primary);
            color: white;
        }
        #generateButton:hover {
            background-color: var(--color-primary-hover);
            transform: translateY(-2px); /* 輕微上浮動畫 */
            box-shadow: 0 6px 12px rgba(0, 123, 255, 0.3);
        }

        /* 校驗按鈕 (綠色輔助色) */
        #calculateButton {
            background-color: var(--color-success);
            color: white;
            margin-top: 15px; /* 與輸入框拉開距離 */
        }
        #calculateButton:hover {
            background-color: #1e7e34;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(40, 167, 69, 0.3);
        }

        /* ================================================= */
        /* == 6. 結果顯示區塊 */
        /* ================================================= */
        .result-box {
            margin-top: 25px;
            padding: 20px;
            border-radius: 8px;
            font-size: 20px;
            font-weight: 700;
            text-align: center;
            word-break: break-all;
            background-color: var(--color-success-light);
            border: 1px solid var(--color-success);
            color: var(--color-text); /* 使用通用文字色 */
            transition: all var(--transition-speed);
        }

        #result.error-box {
            background-color: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }
        .dark-mode #result.error-box {
            background-color: #493134;
            border-color: #a72834;
            color: #ffbaba;
        }

        /* 專門為校驗結果區塊設置的樣式覆蓋 (使其更中性) */
        #result {
            background-color: var(--color-input-bg); 
            border-color: var(--color-border);
            color: var(--color-text);
            font-weight: 400; /* 降低字重 */
            font-size: 16px;
        }

        /* ================================================= */
        /* == 7. 日夜間切換開關 */
        /* ================================================= */
        #modeToggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background-color: var(--color-card-bg);
            color: var(--color-text);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            font-size: 20px;
            cursor: pointer;
            z-index: 1000;
            transition: all var(--transition-speed);
        }
        #modeToggle:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.25);
        }
    </style>
</head>
<body class="light-mode">

    <button id="modeToggle" onclick="toggleDarkMode()" title="切換日夜間模式">
        ☀️
    </button>
    
    <header>
        <h1>身份證號碼工具箱</h1>
        <p style="opacity: 0.7;">現代化生成與格式校驗，讓你的資料處理更輕鬆。</p>
    </header>

    <div class="card-container">
        <h2>區塊一：身份證號碼生成器</h2>
        
        <div class="input-group">
            <label for="provinceSelect">1. 選擇省/自治區/直轄市 (第1~2位):</label>
            <select id="provinceSelect" onchange="populateCities()">
                <option value="" disabled selected>-- 請選擇省份 --</option>
            </select>
        </div>

        <div class="input-group">
            <label for="citySelect">2. 選擇市 (第3~4位):</label>
            <select id="citySelect" onchange="populateDistricts()">
                <option value="">請選擇市</option>
            </select>
        </div>

        <div class="input-group">
            <label for="districtSelect">3. 選擇區/縣 (第5~6位):</label>
            <select id="districtSelect">
                <option value="">請先選擇市</option>
            </select>
        </div>

        <div class="input-group">
            <label for="birthDate">4. 選擇出生日期 (第7~14位):</label>
            <input type="date" id="birthDate" value="2000-01-01">
        </div>

        <div class="input-group">
            <label for="genderSelect">5. 選擇性別 (第17位：奇數男/偶數女):</label>
            <select id="genderSelect">
                <option value="1">男 (奇數)</option>
                <option value="2">女 (偶數)</option>
            </select>
        </div>

        <button id="generateButton" onclick="generateIdCard()">生成完整的身份證號碼</button>

        <div id="generatedId" class="result-box">
            生成的號碼將顯示在這裡。
        </div>
    </div>
    
    <div class="card-container">
        <h2>區塊二：第18位校驗器 (格式檢查)</h2>
        <p style="opacity: 0.7;">請輸入 **前 17 位數字** 來單獨計算第 18 位校驗碼：</p>

        <div class="input-group">
             <input type="text" id="id17Input" maxlength="17" placeholder="例如：43010319710508316" oninput="this.value=this.value.replace(/[^0-9]/g,'')">
        </div>
        
        <button id="calculateButton" onclick="calculateAndDisplay()">計算並檢查</button>

        <div id="result" class="result-box">
            單獨計算結果將顯示在這裡。
        </div>
    </div>

    <script>
        // =============================================
        // 數據庫：全國行政區劃代碼 (因數據量大，此處僅展示部分代碼，你需要將所有代碼粘貼回此處)
        // (請將你原代碼中 AREA_CODES 變量完整的粘貼到這裡的註釋下方)
        // =============================================
        const AREA_CODES = {
            // ==================== 直轄市 (11/12/31/50) ====================
            "北京市 (11)": {
                "京師特區": {
                    "東城區": "110101", "西城區": "110102", "朝陽區": "110105", 
                    "豐台區": "110106", "石景山區": "110107", "海淀區": "110108", 
                    "門頭溝區": "110109", "房山區": "110111", "通州區": "110112", 
                    "順義區": "110113", "昌平區": "110114", "大興區": "110115", 
                    "懷柔區": "110116", "平谷區": "110117", "密雲區": "110118", 
                    "延慶區": "110119",
                    "市轄區(通用)": "110100"
                }
            },
            "天津市 (12)": {
                "天津市": {
                    "和平區": "120101", "河東區": "120102", "河西區": "120103", 
                    "南開區": "120104", "河北區": "120105", "紅橋區": "120106", 
                    "濱海新區": "120116", "東麗區": "120110", "西青區": "120111", 
                    "津南區": "120112", "北辰區": "120113", "武清區": "120114", 
                    "寶坻區": "120115", "寧河區": "120117", "靜海區": "120118", 
                    "薊州區": "120119",
                    "市轄區(通用)": "120100"
                }
            },
            "上海市 (31)": {
                "上海市": {
                    "黃浦區": "310101", "徐匯區": "310104", "長寧區": "310105", 
                    "靜安區": "310106", "普陀區": "310107", "虹口區": "310109", 
                    "楊浦區": "310110", "閔行區": "310112", "寶山區": "310113", 
                    "嘉定區": "310114", "浦東新區": "310115", "金山區": "310116", 
                    "松江區": "310117", "青浦區": "310118", "奉賢區": "310120", 
                    "崇明區": "310151",
                    "市轄區(通用)": "310100"
                }
            },
            "重慶市 (50)": {
                "重慶市": {
                    "萬州區": "500101", "涪陵區": "500102", "渝中區": "500103", 
                    "大渡口區": "500104", "江北區": "500105", "沙坪壩區": "500106", 
                    "九龍坡區": "500107", "南岸區": "500108", "北碚區": "500109", 
                    "綦江區": "500110", "大足區": "500111", "渝北區": "500112", 
                    "巴南區": "500113", "黔江區": "500114", "長壽區": "500115", 
                    "江津區": "500116", "合川區": "500117", "永川區": "500118", 
                    "南川區": "500119", "璧山區": "500120", "銅梁區": "500151", 
                    "潼南區": "500152", "榮昌區": "500153", "開州區": "500154", 
                    "梁平區": "500155", "武隆區": "500156", 
                    "區縣(通用)": "500200"
                }
            },
            // ==================== 華北地區 ====================
            "河北省 (13)": {
                "石家莊市": { "長安區": "130102", "橋西區": "130104", "新華區": "130105", "裕華區": "130108", "鹿泉區": "130109", "藁城區": "130110", "欒城區": "130111", "井陘縣": "130121", "晉州市": "130183", "新樂市": "130184", "市轄區(通用)": "130100" },
                "唐山市": { "路南區": "130202", "路北區": "130203", "古冶區": "130204", "開平區": "130205", "豐南區": "130207", "豐潤區": "130208", "灤州市": "130284", "遷安市": "130283", "市轄區(通用)": "130200" },
                "秦皇島市": { "海港區": "130302", "山海關區": "130303", "北戴河區": "130304", "撫寧區": "130306", "青龍滿族自治縣": "130321", "市轄區(通用)": "130300" },
                "邯鄲市": { "叢台區": "130403", "復興區": "130404", "邯山區": "130406", "肥鄉區": "130407", "永年區": "130408", "武安市": "130481", "市轄區(通用)": "130400" },
                "邢臺市": { "襄都區": "130502", "信都區": "130503", "南和區": "130506", "沙河市": "130582", "市轄區(通用)": "130500" },
                "保定市": { "競秀區": "130602", "蓮池區": "130603", "滿城區": "130604", "徐水區": "130606", "涿州市": "130681", "定州市": "130682", "市轄區(通用)": "130600" },
                "張家口市": { "橋東區": "130702", "橋西區": "130703", "宣化區": "130705", "下花園區": "130706", "萬全區": "130708", "懷來縣": "130724", "市轄區(通用)": "130700" },
                "承德市": { "雙橋區": "130802", "雙灤區": "130803", "鷹手營子礦區": "130804", "興隆縣": "130823", "平泉市": "130881", "市轄區(通用)": "130800" },
                "滄州市": { "新華區": "130902", "運河區": "130903", "泊頭市": "130981", "任丘市": "130982", "黃驊市": "130983", "河間市": "130984", "市轄區(通用)": "130900" },
                "廊坊市": { "安次區": "131002", "廣陽區": "131003", "霸州市": "131081", "三河市": "131082", "市轄區(通用)": "131000" },
                "衡水市": { "桃城區": "131102", "冀州區": "131103", "深州市": "131182", "市轄區(通用)": "131100" }
            },
            "山西省 (14)": {
                "太原市": { "小店區": "140105", "迎澤區": "140106", "杏花嶺區": "140107", "尖草坪區": "140108", "萬柏林區": "140109", "晉源區": "140110", "古交市": "140181", "市轄區(通用)": "140100" },
                "大同市": { "新榮區": "140212", "平城區": "140202", "雲岡區": "140203", "渾源縣": "140226", "市轄區(通用)": "140200" },
                "陽泉市": { "城區": "140302", "礦區": "140303", "盂縣": "140322", "市轄區(通用)": "140300" },
                "長治市": { "潞州區": "140403", "上黨區": "140405", "襄垣縣": "140421", "沁源縣": "140428", "沁縣": "140429", "市轄區(通用)": "140400" },
                "晉城市": { "城區": "140502", "高平市": "140581", "市轄區(通用)": "140500" },
                "朔州市": { "朔城區": "140602", "山陰縣": "140621", "市轄區(通用)": "140600" },
                "晉中市": { "榆次區": "140702", "介休市": "140781", "市轄區(通用)": "140700" },
                "運城市": { "鹽湖區": "140802", "永濟市": "140881", "河津市": "140882", "市轄區(通用)": "140800" },
                "忻州市": { "忻府區": "140902", "原平市": "140981", "市轄區(通用)": "140900" },
                "臨汾市": { "堯都區": "141002", "侯馬市": "141081", "霍州市": "141082", "市轄區(通用)": "141000" },
                "呂梁市": { "離石區": "141102", "孝義市": "141181", "汾陽市": "141182", "市轄區(通用)": "141100" }
            },
            "內蒙古自治區 (15)": {
                "呼和浩特市": { "新城區": "150102", "回民區": "150103", "賽罕區": "150105", "土默特左旗": "150121", "市轄區(通用)": "150100" },
                "包頭市": { "東河區": "150202", "昆都侖區": "150203", "青山區": "150204", "九原區": "150207", "固陽縣": "150222", "市轄區(通用)": "150200" },
                "呼倫貝爾市": { "海拉爾區": "150702", "滿洲里市": "150781", "牙克石市": "150782", "市轄區(通用)": "150700" },
                "赤峰市": { "紅山區": "150402", "元寶山區": "150403", "阿魯科爾沁旗": "150421", "市轄區(通用)": "150400" },
                "通遼市": { "科爾沁區": "150502", "霍林郭勒市": "150581", "市轄區(通用)": "150500" },
                "鄂爾多斯市": { "東勝區": "150602", "康巴什區": "150603", "市轄區(通用)": "150600" },
                "烏蘭察布市": { "集寧區": "150902", "豐鎮市": "150981", "市轄區(通用)": "150900" },
                "巴彥淖爾市": { "臨河區": "150802", "市轄區(通用)": "150800" },
                "烏海市": { "海勃灣區": "150302", "市轄區(通用)": "150300" },
                "阿拉善盟": { "阿拉善左旗": "152921", "額濟納旗": "152923", "盟轄區(通用)": "152900" },
                "錫林郭勒盟": { "錫林浩特市": "152501", "二連浩特市": "152502", "盟轄區(通用)": "152500" },
                "興安盟": { "烏蘭浩特市": "152201", "阿爾山市": "152202", "盟轄區(通用)": "152200" }
            },
            // ==================== 東北地區 ====================
            "遼寧省 (21)": {
                "瀋陽市": { "和平區": "210102", "沈河區": "210103", "大東區": "210104", "皇姑區": "210105", "鐵西區": "210106", "蘇家屯區": "210111", "渾南區": "210112", "新民市": "210181", "市轄區(通用)": "210100" },
                "大連市": { "中山區": "210202", "西崗區": "210203", "沙河口區": "210204", "甘井子區": "210211", "旅順口區": "210212", "金州區": "210213", "普蘭店區": "210214", "瓦房店市": "210281", "莊河市": "210283", "市轄區(通用)": "210200" },
                "鞍山市": { "鐵東區": "210302", "鐵西區": "210303", "立山區": "210304", "千山區": "210311", "海城市": "210381", "市轄區(通用)": "210300" },
                "撫順市": { "新撫區": "210402", "東洲區": "210403", "望花區": "210404", "順城區": "210411", "清原滿族自治縣": "210423", "市轄區(通用)": "210400" },
                "本溪市": { "平山區": "210502", "溪湖區": "210503", "明山區": "210504", "南芬區": "210505", "本溪滿族自治縣": "210521", "市轄區(通用)": "210500" },
                "丹東市": { "元寶區": "210602", "振興區": "210603", "振安區": "210604", "東港市": "210681", "鳳城市": "210682", "市轄區(通用)": "210600" },
                "錦州市": { "古塔區": "210702", "凌河區": "210703", "太和區": "210711", "凌海市": "210781", "北鎮市": "210782", "市轄區(通用)": "210700" },
                "營口市": { "站前區": "210802", "西市區": "210803", "鮁魚圈區": "210804", "老邊區": "210811", "大石橋市": "210881", "蓋州市": "210882", "市轄區(通用)": "210800" },
                "阜新市": { "海州區": "210902", "新邱區": "210903", "太平區": "210904", "清河門區": "210905", "市轄區(通用)": "210900" },
                "遼陽市": { "白塔區": "211002", "文聖區": "211003", "宏偉區": "211004", "太子河區": "211005", "燈塔市": "211081", "市轄區(通用)": "211000" },
                "盤錦市": { "雙台子區": "211102", "興隆台區": "211103", "大窪區": "211104", "市轄區(通用)": "211100" },
                "鐵嶺市": { "銀州區": "211202", "清河區": "211204", "調兵山市": "211281", "開原市": "211282", "市轄區(通用)": "211200" },
                "朝陽市": { "雙塔區": "211302", "龍城區": "211303", "北票市": "211381", "凌源市": "211382", "市轄區(通用)": "211300" },
                "葫蘆島市": { "連山區": "211402", "龍港區": "211403", "南票區": "211404", "興城市": "211481", "市轄區(通用)": "211400" }
            },
            "吉林省 (22)": {
                "長春市": { "南關區": "220102", "寬城區": "220103", "朝陽區": "220104", "二道區": "220105", "綠園區": "220106", "雙陽區": "220112", "九台區": "220113", "榆樹市": "220182", "德惠市": "220183", "市轄區(通用)": "220100" },
                "吉林市": { "昌邑區": "220202", "龍潭區": "220203", "船營區": "220204", "豐滿區": "220211", "舒蘭市": "220283", "磐石市": "220284", "蛟河市": "220281", "樺甸市": "220282", "市轄區(通用)": "220200" },
                "四平市": { "鐵西區": "220302", "鐵東區": "220303", "公主嶺市": "220381", "雙遼市": "220382", "市轄區(通用)": "220300" },
                "遼源市": { "龍山區": "220402", "西安區": "220403", "東豐縣": "220421", "東遼縣": "220422", "市轄區(通用)": "220400" },
                "通化市": { "東昌區": "220502", "二道江區": "220503", "梅河口市": "220581", "集安市": "220582", "市轄區(通用)": "220500" },
                "白山市": { "渾江區": "220602", "江源區": "220605", "臨江市": "220681", "靖宇縣": "220622", "市轄區(通用)": "220600" },
                "松原市": { "寧江區": "220702", "扶余市": "220781", "市轄區(通用)": "220700" },
                "白城市": { "洮北區": "220802", "大安市": "220882", "市轄區(通用)": "220800" },
                "延邊朝鮮族自治州": { "延吉市": "222401", "圖們市": "222402", "敦化市": "222403", "盟轄區(通用)": "222400" }
            },
            "黑龍江省 (23)": {
                "哈爾濱市": { "道裏區": "230102", "南崗區": "230103", "道外區": "230104", "平房區": "230108", "鬆北區": "230109", "阿城區": "230112", "雙城區": "230113", "尚志市": "230183", "市轄區(通用)": "230100" },
                "齊齊哈爾市": { "龍沙區": "230202", "建華區": "230203", "鐵鋒區": "230204", "富拉爾基區": "230206", "訥河市": "230281", "市轄區(通用)": "230200" },
                "雞西市": { "雞冠區": "230302", "恆山區": "230303", "滴道區": "230304", "城子河區": "230305", "虎林市": "230381", "市轄區(通用)": "230300" },
                "鶴崗市": { "向陽區": "230402", "工農區": "230403", "南山區": "230404", "興安區": "230405", "市轄區(通用)": "230400" },
                "雙鴨山市": { "尖山區": "230502", "嶺東區": "230503", "四方台區": "230505", "寶清縣": "230523", "市轄區(通用)": "230500" },
                "大慶市": { "薩爾圖區": "230602", "龍鳳區": "230603", "讓胡路區": "230604", "紅崗區": "230605", "市轄區(通用)": "230600" },
                "伊春市": { "伊美區": "230702", "鐵力市": "230781", "市轄區(通用)": "230700" },
                "佳木斯市": { "向陽區": "230803", "前進區": "230804", "東風區": "230805", "同江市": "230881", "撫遠市": "230883", "市轄區(通用)": "230800" },
                "七台河市": { "新興區": "230902", "桃山區": "230903", "勃利縣": "230921", "市轄區(通用)": "230900" },
                "牡丹江市": { "東安區": "231002", "陽明區": "231003", "愛民區": "231004", "穆稜市": "231085", "綏芬河市": "231086", "海林市": "231083", "寧安市": "231084", "市轄區(通用)": "231000" },
                "黑河市": { "愛輝區": "231102", "北安市": "231181", "五大連池市": "231182", "市轄區(通用)": "231100" },
                "綏化市": { "北林區": "231202", "安達市": "231281", "肇東市": "231283", "海倫市": "231284", "市轄區(通用)": "231200" },
                "大興安嶺地區": { "漠河市": "232701", "呼瑪縣": "232721", "塔河縣": "232722", "區縣(通用)": "232700" }
            },
            // ==================== 華東地區 ====================
            "江蘇省 (32)": {
                "南京市": { "玄武區": "320102", "秦淮區": "320104", "建鄴區": "320105", "鼓樓區": "320106", "棲霞區": "320113", "雨花台區": "320114", "江寧區": "320115", "浦口區": "320111", "溧水區": "320117", "高淳區": "320118", "市轄區(通用)": "320100" },
                "無錫市": { "錫山區": "320205", "惠山區": "320206", "濱湖區": "320211", "梁溪區": "320213", "新吳區": "320214", "江陰市": "320281", "宜興市": "320282", "市轄區(通用)": "320200" },
                "徐州市": { "鼓樓區": "320302", "雲龍區": "320303", "賈汪區": "320305", "泉山區": "320311", "銅山區": "320312", "新沂市": "320381", "邳州市": "320382", "市轄區(通用)": "320300" },
                "常州市": { "天寧區": "320402", "鐘樓區": "320404", "新北區": "320411", "武進區": "320412", "溧陽市": "320481", "金壇區": "320413", "市轄區(通用)": "320400" },
                "蘇州市": { "虎丘區": "320505", "吳中區": "320506", "相城區": "320507", "姑蘇區": "320508", "吳江區": "320509", "常熟市": "320581", "張家港市": "320582", "崑山市": "320583", "太倉市": "320585", "市轄區(通用)": "320500" },
                "南通市": { "崇川區": "320602", "通州區": "320612", "啟東市": "320681", "如皋市": "320682", "海門區": "320614", "市轄區(通用)": "320600" },
                "連雲港市": { "連雲區": "320703", "海州區": "320706", "東方市": "320781", "市轄區(通用)": "320700" },
                "淮安市": { "淮安區": "320803", "淮陰區": "320804", "清江浦區": "320812", "漣水縣": "320826", "市轄區(通用)": "320800" },
                "鹽城市": { "亭湖區": "320902", "鹽都區": "320903", "東台市": "320981", "大豐區": "320904", "射陽縣": "320924", "建湖縣": "320925", "市轄區(通用)": "320900" },
                "揚州市": { "廣陵區": "321002", "邗江區": "321003", "江都區": "321012", "儀徵市": "321081", "高郵市": "321084", "市轄區(通用)": "321000" },
                "鎮江市": { "京口區": "321102", "潤州區": "321111", "丹徒區": "321112", "丹陽市": "321181", "揚中市": "321182", "句容市": "321183", "市轄區(通用)": "321100" },
                "泰州市": { "海陵區": "321202", "高港區": "321203", "靖江市": "321282", "泰興市": "321283", "姜堰區": "321204", "市轄區(通用)": "321200" },
                "宿遷市": { "宿城區": "321302", "宿豫區": "321311", "沭陽縣": "321322", "市轄區(通用)": "321300" }
            },
            "浙江省 (33)": {
                "杭州市": { "上城區": "330102", "拱墅區": "330105", "西湖區": "330106", "濱江區": "330108", "蕭山區": "330109", "餘杭區": "330110", "臨平區": "330113", "錢塘區": "330114", "臨安區": "330112", "建德市": "330182", "市轄區(通用)": "330100" },
                "寧波市": { "海曙區": "330203", "江北區": "330205", "北侖區": "330206", "鎮海區": "330211", "鄞州區": "330212", "奉化區": "330213", "餘姚市": "330281", "慈溪市": "330282", "市轄區(通用)": "330200" },
                "溫州市": { "鹿城區": "330302", "龍灣區": "330303", "甌海區": "330304", "樂清市": "330382", "瑞安市": "330381", "龍港市": "330383", "市轄區(通用)": "330300" },
                "嘉興市": { "南湖區": "330402", "秀洲區": "330411", "海寧市": "330481", "平湖市": "330482", "桐鄉市": "330483", "市轄區(通用)": "330400" },
                "湖州市": { "吳興區": "330502", "南潯區": "330503", "德清縣": "330521", "長興縣": "330522", "市轄區(通用)": "330500" },
                "紹興市": { "越城區": "330602", "柯橋區": "330603", "上虞區": "330604", "諸暨市": "330681", "嵊州市": "330683", "新昌縣": "330624", "市轄區(通用)": "330600" },
                "金華市": { "婺城區": "330702", "金義新區": "330703", "蘭溪市": "330781", "義烏市": "330782", "東陽市": "330783", "永康市": "330784", "市轄區(通用)": "330700" },
                "衢州市": { "柯城區": "330802", "衢江區": "330803", "江山市": "330881", "市轄區(通用)": "330800" },
                "舟山市": { "定海區": "330902", "普陀區": "330903", "岱山縣": "330921", "市轄區(通用)": "330900" },
                "台州市": { "椒江區": "331002", "黃巖區": "331003", "路橋區": "331004", "臨海市": "331082", "溫嶺市": "331081", "玉環市": "331083", "市轄區(通用)": "331000" },
                "麗水市": { "蓮都區": "331102", "龍泉市": "331181", "青田縣": "331121", "市轄區(通用)": "331100" }
            },
            "安徽省 (34)": {
                "合肥市": { "瑤海區": "340102", "廬陽區": "340103", "蜀山區": "340104", "包河區": "340111", "長豐縣": "340121", "肥西縣": "340123", "廬江縣": "340124", "巢湖市": "340181", "市轄區(通用)": "340100" },
                "蕪湖市": { "鏡湖區": "340202", "弋江區": "340203", "灣沚區": "340207", "繁昌區": "340208", "無為市": "340281", "市轄區(通用)": "340200" },
                "蚌埠市": { "龍子湖區": "340302", "蚌山區": "340303", "懷遠縣": "340321", "市轄區(通用)": "340300" },
                "淮南市": { "大通區": "340402", "田家庵區": "340403", "謝家集區": "340404", "鳳台縣": "340421", "壽縣": "340422", "市轄區(通用)": "340400" },
                "馬鞍山市": { "花山區": "340503", "雨山區": "340504", "當塗縣": "340521", "含山縣": "340522", "市轄區(通用)": "340500" },
                "淮北市": { "杜集區": "340602", "相山區": "340603", "烈山區": "340604", "市轄區(通用)": "340600" },
                "銅陵市": { "銅官區": "340705", "郊區": "340706", "樅陽縣": "340722", "市轄區(通用)": "340700" },
                "安慶市": { "迎江區": "340802", "大觀區": "340803", "宜秀區": "340811", "桐城市": "340881", "潛山市": "340882", "市轄區(通用)": "340800" },
                "黃山市": { "屯溪區": "341002", "黃山區": "341003", "徽州區": "341004", "祁門縣": "341021", "市轄區(通用)": "341000" },
                "滁州市": { "琅琊區": "341102", "南譙區": "341103", "天長市": "341181", "明光市": "341182", "市轄區(通用)": "341100" },
                "阜陽市": { "潁州區": "341202", "潁東區": "341203", "界首市": "341282", "市轄區(通用)": "341200" },
                "宿州市": { "埇橋區": "341302", "碭山縣": "341321", "市轄區(通用)": "341300" },
                "六安市": { "金安區": "341502", "裕安區": "341503", "霍山縣": "341525", "市轄區(通用)": "341500" },
                "亳州市": { "譙城區": "341602", "渦陽縣": "341621", "市轄區(通用)": "341600" },
                "池州市": { "貴池區": "341702", "東至縣": "341721", "市轄區(通用)": "341700" },
                "宣城市": { "宣州區": "341802", "寧國市": "341881", "市轄區(通用)": "341800" }
            },
            "福建省 (35)": {
                "福州市": { "鼓樓區": "350102", "台江區": "350103", "倉山區": "350104", "馬尾區": "350105", "晉安區": "350111", "長樂區": "350112", "福清市": "350181", "市轄區(通用)": "350100" },
                "廈門市": { "思明區": "350203", "海滄區": "350205", "湖裏區": "350206", "集美區": "350211", "同安區": "350212", "翔安區": "350213", "市轄區(通用)": "350200" },
                "莆田市": { "城廂區": "350302", "漢濱區": "350303", "荔城區": "350304", "秀嶼區": "350305", "市轄區(通用)": "350300" },
                "三明市": { "梅列區": "350402", "三元區": "350403", "永安市": "350481", "市轄區(通用)": "350400" },
                "泉州市": { "鯉城區": "350502", "豐澤區": "350503", "洛江區": "350504", "泉港區": "350505", "晉江市": "350582", "石獅市": "350581", "南安市": "350583", "市轄區(通用)": "350500" },
                "漳州市": { "薌城區": "350602", "龍文區": "350603", "龍海區": "350606", "漳浦縣": "350623", "市轄區(通用)": "350600" },
                "南平市": { "延平區": "350702", "建甌市": "350783", "邵武市": "350781", "武夷山市": "350782", "市轄區(通用)": "350700" },
                "龍巖市": { "新羅區": "350802", "漳平市": "350881", "市轄區(通用)": "350800" },
                "寧德市": { "蕉城區": "350902", "福安市": "350981", "福鼎市": "350982", "市轄區(通用)": "350900" }
            },
            "江西省 (36)": {
                "南昌市": { "東湖區": "360102", "西湖區": "360103", "青雲譜區": "360104", "青山湖區": "360105", "新建區": "360111", "市轄區(通用)": "360100" },
                "景德鎮市": { "昌江區": "360202", "珠山區": "360203", "樂平市": "360281", "市轄區(通用)": "360200" },
                "萍鄉市": { "安源區": "360302", "湘東區": "360313", "市轄區(通用)": "360300" },
                "九江市": { "潯陽區": "360403", "濂溪區": "360404", "瑞昌市": "360481", "共青城市": "360482", "廬山市": "360483", "市轄區(通用)": "360400" },
                "新餘市": { "渝水區": "360502", "分宜縣": "360521", "市轄區(通用)": "360500" },
                "鷹潭市": { "月湖區": "360602", "貴溪市": "360681", "市轄區(通用)": "360600" },
                "贛州市": { "章貢區": "360702", "南康區": "360703", "瑞金市": "360781", "市轄區(通用)": "360700" },
                "吉安市": { "吉州區": "360802", "青原區": "360803", "井岡山市": "360881", "市轄區(通用)": "360800" },
                "宜春市": { "袁州區": "360902", "豐城市": "360981", "樟樹市": "360982", "高安市": "360983", "市轄區(通用)": "360900" },
                "撫州市": { "臨川區": "361002", "南城縣": "361021", "東鄉區": "361003", "市轄區(通用)": "361000" },
                "上饒市": { "信州區": "361102", "廣豐區": "361103", "德興市": "361181", "市轄區(通用)": "361100" }
            },
            "山東省 (37)": {
                "濟南市": { "歷下區": "370102", "市中區": "370103", "槐蔭區": "370104", "天橋區": "370105", "歷城區": "370112", "長清區": "370113", "章丘區": "370114", "濟陽區": "370115", "萊蕪區": "370116", "鋼城區": "370117", "市轄區(通用)": "370100" },
                "青島市": { "市南區": "370202", "市北區": "370203", "黃島區": "370211", "嶗山區": "370212", "李滄區": "370213", "城陽區": "370214", "即墨區": "370215", "膠州市": "370281", "平度市": "370283", "市轄區(通用)": "370200" },
                "淄博市": { "淄川區": "370302", "張店區": "370303", "博山區": "370304", "臨淄區": "370305", "周村區": "370306", "市轄區(通用)": "370300" },
                "棗莊市": { "市中區": "370402", "薛城區": "370403", "嶧城區": "370404", "台兒莊區": "370405", "滕州市": "370481", "市轄區(通用)": "370400" },
                "東營市": { "東營區": "370502", "河口區": "370503", "墾利區": "370505", "市轄區(通用)": "370500" },
                "煙台市": { "芝罘區": "370602", "福山區": "370611", "牟平區": "370612", "萊山區": "370613", "龍口市": "370681", "萊陽市": "370682", "萊州市": "370683", "蓬萊區": "370614", "市轄區(通用)": "370600" },
                "濰坊市": { "濰城區": "370702", "寒亭區": "370703", "坊子區": "370704", "奎文區": "370705", "青州市": "370781", "諸城市": "370782", "壽光市": "370783", "安丘市": "370784", "昌邑市": "370786", "市轄區(通用)": "370700" },
                "濟寧市": { "任城區": "370811", "兗州區": "370812", "曲阜市": "370881", "鄒城市": "370883", "市轄區(通用)": "370800" },
                "泰安市": { "泰山區": "370902", "岱嶽區": "370903", "新泰市": "370982", "肥城市": "370983", "市轄區(通用)": "370900" },
                "威海市": { "環翠區": "371002", "文登區": "371003", "榮成市": "371082", "乳山市": "371083", "市轄區(通用)": "371000" },
                "日照市": { "東港區": "371102", "嵐山區": "371103", "市轄區(通用)": "371100" },
                "臨沂市": { "蘭山區": "371302", "羅莊區": "371303", "河東區": "371304", "市轄區(通用)": "371300" },
                "德州市": { "德城區": "371402", "陵城區": "371403", "樂陵市": "371481", "禹城市": "371482", "市轄區(通用)": "371400" },
                "聊城市": { "東昌府區": "371502", "臨清市": "371581", "市轄區(通用)": "371500" },
                "濱州市": { "濱城區": "371602", "霑化區": "371603", "市轄區(通用)": "371600" },
                "菏澤市": { "牡丹區": "371702", "定陶區": "371703", "東明縣": "371728", "市轄區(通用)": "371700" }
            },
            // ==================== 華中地區 ====================
            "河南省 (41)": {
                "鄭州市": { "中原區": "410102", "二七區": "410103", "金水區": "410105", "上街區": "410106", "惠濟區": "410108", "鞏義市": "410181", "滎陽市": "410182", "新鄭市": "410184", "登封市": "410185", "新密市": "410183", "市轄區(通用)": "410100" },
                "開封市": { "龍亭區": "410202", "鼓樓區": "410203", "順河回族區": "410204", "禹王台區": "410205", "市轄區(通用)": "410200" },
                "洛陽市": { "老城區": "410302", "西工區": "410303", "瀍河回族區": "410304", "澗西區": "410305", "吉利區": "410306", "偃師市": "410381", "宜陽縣": "410327", "市轄區(通用)": "410300" },
                "平頂山市": { "新華區": "410402", "衛東區": "410403", "湛河區": "410404", "舞鋼市": "410481", "汝州市": "410482", "市轄區(通用)": "410400" },
                "安陽市": { "文峰區": "410502", "北關區": "410503", "殷都區": "410505", "龍安區": "410506", "林州市": "410581", "市轄區(通用)": "410500" },
                "鶴壁市": { "鶴山區": "410602", "山城區": "410603", "淇濱區": "410611", "市轄區(通用)": "410600" },
                "新鄉市": { "紅旗區": "410702", "衛濱區": "410703", "鳳泉區": "410704", "牧野區": "410711", "衛輝市": "410781", "市轄區(通用)": "410700" },
                "焦作市": { "解放區": "410802", "中站區": "410803", "馬村區": "410804", "山陽區": "410811", "沁陽市": "410882", "孟州市": "410883", "市轄區(通用)": "410800" },
                "濮陽市": { "華龍區": "410902", "清豐縣": "410922", "南樂縣": "410923", "市轄區(通用)": "410900" },
                "許昌市": { "魏都區": "411002", "建安區": "411004", "禹州市": "411081", "長葛市": "411082", "市轄區(通用)": "411000" },
                "漯河市": { "源匯區": "411102", "郾城區": "411103", "舞陽縣": "411121", "市轄區(通用)": "411100" },
                "三門峽市": { "湖濱區": "411202", "義馬市": "411281", "靈寶市": "411282", "市轄區(通用)": "411200" },
                "南陽市": { "宛城區": "411302", "臥龍區": "411303", "鄧州市": "411381", "市轄區(通用)": "411300" },
                "商丘市": { "梁園區": "411402", "睢陽區": "411403", "永城市": "411481", "市轄區(通用)": "411400" },
                "信陽市": { "溮河區": "411502", "平橋區": "411503", "市轄區(通用)": "411500" },
                "周口市": { "川匯區": "411602", "項城市": "411681", "市轄區(通用)": "411600" },
                "駐馬店市": { "驛城區": "411702", "市轄區(通用)": "411700" },
                "省直轄縣級行政區劃": { "濟源市": "419001" }
            },
            "湖北省 (42)": {
                "武漢市": { "江岸區": "420102", "江漢區": "420103", "礄口區": "420104", "漢陽區": "420105", "武昌區": "420106", "青山區": "420107", "洪山區": "420111", "東西湖區": "420112", "漢南區": "420113", "蔡甸區": "420114", "江夏區": "420115", "黃陂區": "420116", "新洲區": "420117", "市轄區(通用)": "420100" },
                "黃石市": { "黃石港區": "420202", "西塞山區": "420203", "下陸區": "420204", "鐵山區": "420205", "大冶市": "420281", "市轄區(通用)": "420200" },
                "十堰市": { "茅箭區": "420302", "張灣區": "420303", "丹江口市": "420381", "市轄區(通用)": "420300" },
                "宜昌市": { "西陵區": "420502", "伍家崗區": "420503", "點軍區": "420504", "猇亭區": "420505", "夷陵區": "420506", "宜都市": "420581", "當陽市": "420582", "枝江市": "420583", "市轄區(通用)": "420500" },
                "襄陽市": { "襄州區": "420607", "襄城區": "420602", "樊城區": "420603", "老河口市": "420682", "棗陽市": "420683", "宜城市": "420684", "市轄區(通用)": "420600" },
                "鄂州市": { "梁子湖區": "420702", "華容區": "420703", "鄂城區": "420704", "市轄區(通用)": "420700" },
                "荊門市": { "東寶區": "420802", "掇刀區": "420804", "鍾祥市": "420881", "京山市": "420882", "市轄區(通用)": "420800" },
                "孝感市": { "孝南區": "420902", "應城市": "420981", "安陸市": "420982", "漢川市": "420984", "市轄區(通用)": "420900" },
                "荊州市": { "沙市區": "421002", "荊州區": "421003", "石首市": "421081", "洪湖市": "421083", "松滋市": "421087", "市轄區(通用)": "421000" },
                "黃岡市": { "黃州區": "421102", "麻城市": "421181", "武穴市": "421182", "市轄區(通用)": "421100" },
                "咸寧市": { "咸安區": "421202", "赤壁市": "421281", "市轄區(通用)": "421200" },
                "隨州市": { "曾都區": "421303", "廣水市": "421381", "市轄區(通用)": "421300" },
                "恩施土家族苗族自治州": { "恩施市": "422801", "利川市": "422802", "盟轄區(通用)": "422800" },
                "省直轄縣級行政區劃": { "仙桃市": "429004", "潛江市": "429005", "天門市": "429006", "神農架林區": "429021" }
            },
            "湖南省 (43)": {
                "長沙市": { "芙蓉區": "430102", "天心區": "430103", "嶽麓區": "430104", "開福區": "430105", "雨花區": "430111", "望城區": "430112", "瀏陽市": "430181", "寧鄉市": "430182", "市轄區(通用)": "430100" },
                "株洲市": { "荷塘區": "430202", "蘆淞區": "430203", "石峰區": "430204", "天元區": "430211", "醴陵市": "430281", "市轄區(通用)": "430200" },
                "湘潭市": { "嶽塘區": "430304", "雨湖區": "430302", "湘鄉市": "430381", "韶山市": "430382", "市轄區(通用)": "430300" },
                "衡陽市": { "珠暉區": "430405", "雁峰區": "430406", "石鼓區": "430407", "蒸湘區": "430408", "耒陽市": "430481", "常寧市": "430482", "市轄區(通用)": "430400" },
                "邵陽市": { "雙清區": "430502", "大祥區": "430503", "北塔區": "430511", "武岡市": "430581", "邵東市": "430582", "市轄區(通用)": "430500" },
                "嶽陽市": { "嶽陽樓區": "430602", "君山區": "430603", "雲溪區": "430604", "臨湘市": "430681", "汨羅市": "430682", "市轄區(通用)": "430600" },
                "常德市": { "武陵區": "430702", "鼎城區": "430703", "津市市": "430781", "市轄區(通用)": "430700" },
                "張家界市": { "永定區": "430802", "武陵源區": "430811", "市轄區(通用)": "430800" },
                "益陽市": { "赫山區": "430902", "資陽區": "430903", "沅江市": "430981", "市轄區(通用)": "430900" },
                "郴州市": { "北湖區": "431002", "蘇仙區": "431003", "資興市": "431081", "市轄區(通用)": "431000" },
                "永州市": { "零陵區": "431102", "冷水灘區": "431103", "市轄區(通用)": "431100" },
                "懷化市": { "鶴城區": "431202", "洪江市": "431281", "市轄區(通用)": "431200" },
                "婁底市": { "婁星區": "431302", "漣源市": "431382", "冷水江市": "431381", "市轄區(通用)": "431300" },
                "湘西土家族苗族自治州": { "吉首市": "433101", "盟轄區(通用)": "433100" }
            },
            // ==================== 華南地區 (廣東為您原先提供的 V4.1 代碼) ====================
            "廣東省 (44)": {
                "廣州市": {
                    "荔灣區": "440103", "越秀區": "440104", "海珠區": "440105", 
                    "天河區": "440106", "白雲區": "440111", "黃埔區": "440112", 
                    "番禺區": "440113", "花都區": "440114", "南沙區": "440115", 
                    "從化區": "440117", "增城區": "440118",
                    "市轄區(通用)": "440100" 
                },
                "韶關市": {
                    "武江區": "440203", "貞江區": "440204", "曲江區": "440205", 
                    "始興縣": "440222", "仁化縣": "440224", "翁源縣": "440229", 
                    "乳源瑤族自治縣": "440232", "新豐縣": "440233", "樂昌市": "440281", 
                    "南雄市": "440282",
                    "市轄區(通用)": "440200"
                },
                "深圳市": {
                    "羅湖區": "440303", "福田區": "440304", "南山區": "440305", 
                    "寶安區": "440306", "龍崗區": "440307", "鹽田區": "440308", 
                    "龍華區": "440309", "坪山區": "440310", "光明區": "440311",
                    "市轄區(通用)": "440300"
                },
                "珠海市": {
                    "香洲區": "440402", "斗門區": "440403", "金灣區": "440404",
                    "市轄區(通用)": "440400"
                },
                "汕頭特區": {
                    "阿平區": "440507", "小豪🤪🔫區": "440511", "bonjour區": "440513", 
                    "潤生區": "440514", "啊全區": "440515", "澳大利亞縣": "440523",
                    "本科區(通用)": "440500"
                },
                "佛山市": {
                     // ⚠️ 注意：這裡的數據在你提供的原始碼中不完整，我將停止此處的粘貼。
                     // 請記得將你原始碼中 AREA_CODES 變量 **完整地** 粘貼到上面的註釋下方
                }
            },
            // ... (其他省份代碼)
        };

        // =============================================
        // 日夜間模式切換邏輯
        // =============================================
        function toggleDarkMode() {
            const body = document.body;
            const toggleButton = document.getElementById('modeToggle');
            body.classList.toggle('dark-mode');

            // 更新按鈕圖標
            if (body.classList.contains('dark-mode')) {
                toggleButton.innerHTML = '🌙';
            } else {
                toggleButton.innerHTML = '☀️';
            }
        }
        
        // 頁面加載時檢查用戶是否偏好深色模式
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.body.classList.add('dark-mode');
            document.getElementById('modeToggle').innerHTML = '🌙';
        }

        // =============================================
        // 身份證號碼生成與校驗核心函數 (保留你的原始邏輯，以確保功能正常)
        // =============================================

        // 填充省份下拉選單
        function populateProvinces() {
            const select = document.getElementById('provinceSelect');
            for (const province in AREA_CODES) {
                const option = document.createElement('option');
                option.value = province;
                option.textContent = province;
                select.appendChild(option);
            }
        }

        // 填充市下拉選單
        function populateCities() {
            const province = document.getElementById('provinceSelect').value;
            const citySelect = document.getElementById('citySelect');
            const districtSelect = document.getElementById('districtSelect');

            citySelect.innerHTML = '<option value="">請選擇市</option>';
            districtSelect.innerHTML = '<option value="">請先選擇市</option>';

            if (province && AREA_CODES[province]) {
                for (const city in AREA_CODES[province]) {
                    const option = document.createElement('option');
                    option.value = city;
                    option.textContent = city;
                    citySelect.appendChild(option);
                }
            }
        }

        // 填充區/縣下拉選單
        function populateDistricts() {
            const province = document.getElementById('provinceSelect').value;
            const city = document.getElementById('citySelect').value;
            const districtSelect = document.getElementById('districtSelect');

            districtSelect.innerHTML = '<option value="">請選擇區/縣</option>';

            if (province && city && AREA_CODES[province][city]) {
                for (const district in AREA_CODES[province][city]) {
                    const option = document.createElement('option');
                    option.value = AREA_CODES[province][city][district];
                    option.textContent = district + ' (' + AREA_CODES[province][city][district] + ')';
                    districtSelect.appendChild(option);
                }
            }
        }
        
        // 校驗碼計算函數 (M)
        function calculateCheckCode(id17) {
            const factors = [7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2];
            const checkCodes = ['1', '0', 'X', '9', '8', '7', '6', '5', '4', '3', '2'];
            let sum = 0;

            for (let i = 0; i < 17; i++) {
                sum += parseInt(id17.charAt(i)) * factors[i];
            }
            const M = sum % 11;
            return checkCodes[M];
        }

        // 生成完整的身份證號碼
        function generateIdCard() {
            const districtCode = document.getElementById('districtSelect').value;
            const birthDate = document.getElementById('birthDate').value.replace(/-/g, ''); // YYYYMMDD
            const genderValue = document.getElementById('genderSelect').value;
            const resultDiv = document.getElementById('generatedId');
            
            resultDiv.classList.remove('error-box'); // 清除錯誤樣式
            
            if (!districtCode) {
                resultDiv.innerHTML = "⚠️ 請先選擇完整的**省份、市、區/縣**。";
                return;
            }

            if (!birthDate || birthDate.length !== 8) {
                resultDiv.innerHTML = "⚠️ 請選擇有效的**出生日期** (YYYY-MM-DD)。";
                return;
            }

            // 隨機生成順序碼 (第15-17位)，確保第17位符合性別要求
            let lastThreeDigits = '';
            let randomCode = 0;
            do {
                randomCode = Math.floor(Math.random() * 1000); // 000 - 999
                lastThreeDigits = randomCode.toString().padStart(3, '0');
                // 檢查第17位是否符合性別要求
            } while ((parseInt(lastThreeDigits.charAt(2)) % 2) !== (parseInt(genderValue) % 2));

            const id17 = districtCode + birthDate + lastThreeDigits;
            const checkCode = calculateCheckCode(id17);
            const fullId = id17 + checkCode;

            resultDiv.innerHTML = `✅ **生成的身份證號碼:** <br> ${fullId}`;
        }

        // 計算並顯示校驗碼
        function calculateAndDisplay() {
            const id17Input = document.getElementById('id17Input').value;
            const resultDiv = document.getElementById('result');

            resultDiv.classList.remove('error-box'); // 清除錯誤樣式

            if (id17Input.length !== 17 || !/^\d{17}$/.test(id17Input)) {
                resultDiv.innerHTML = "❌ **錯誤:** 請輸入正確的 **17 位數字**。";
                resultDiv.classList.add('error-box');
                return;
            }

            const calculatedCode = calculateCheckCode(id17Input);

            resultDiv.innerHTML = `✅ **校驗碼計算結果:** <br> 輸入前 17 位: ${id17Input} <br> 第 18 位校驗碼應為: **${calculatedCode}** <br> 完整號碼為: ${id17Input}${calculatedCode}`;
            resultDiv.style.color = 'var(--color-text)'; // 確保顏色是正常的
            resultDiv.style.borderColor = 'var(--color-success)'; 
            resultDiv.style.backgroundColor = 'var(--color-success-light)';
        }

        // 初始化：填充省份下拉選單
        window.onload = populateProvinces;
    </script>
</body>
</html>
